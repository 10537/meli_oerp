<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>

      <record id="ir_cron_module_get_meli_state" model="ir.cron">
              <field name="name">Get Meli State</field>
              <field eval="True" name="active" />
              <field name="user_id" ref="base.user_root" />
              <field name="interval_number">1</field>
              <!--<field name="nextcall" eval="(DateTime.now() + timedelta(days=1)).strftime('%Y-%m-%d 12:00:00')" />-->
              <field name="interval_type">minutes</field>
              <field name="numbercall">-1</field>
              <field eval="False" name="doall" />
              <field eval="'res.company'" name="model" />
              <field eval="'get_meli_state'" name="function" />
              <field eval="'()'" name="args" />
              <field name="priority">1000</field>
      </record>


      <!-- Error Email template  -->
        <record id="meli_cron_error_mailer" model="mail.template">
            <field name="name">Meli Error</field>
            <field name="email_from">${object.user_id.email or ''}</field>
            <field name="email_to">${object.user_id.email or ''}</field>
            <field name="subject">[DB ${ctx.get('dbname')}] Scheduler '${object.name or ''}' FAILED</field>
            <field name="model_id" ref="base.model_ir_cron"/>
            <field name="auto_delete" eval="True"/>
            <field name="body_html">
                <![CDATA[
<div style="font-family: 'Lucida Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: #FFF; ">
<p>Odoo tried to run the scheduler <em>${object.name or ''}</em> in the database <em>${ctx.get('dbname')}</em> but it failed. Here is the error message :</p>
<strong>
${ctx.get('job_exception') and ctx.get('job_exception').value or 'Failed to get the error message from the context.'}
</strong>
<p>You may check the logs of the Odoo server to get more information about this failure.</p>
<p>Properties of the scheduler <em>${object.name or ''}</em> :</p>
<ul>
<li>Model : ${object.model or ''}</li>
<li>Method : ${object.function or ''}</li>
<li>Arguments : ${object.args or ''}</li>
<li>Interval : ${object.interval_number or '0'} ${object.interval_type or ''}</li>
<li>Number of calls : ${object.numbercall or '0'}</li>
<li>Repeat missed : ${object.doall}</li>
<li>User : ${object.user_id.name or ''}</li>
</ul>
<p>
-- <br/>
Automatic e-mail sent by Odoo. Do not reply.<br/>
Database : ${ctx.get('dbname')}
</p>
</div>
    ]]>
            </field>
</record>

		<record model="ir.actions.act_url" id="meli_login_action">
			<field name="name">meli_login_action</field>
			<field name="url">/meli_login</field>
			<field name="target">new</field>
		</record>

        <record model="ir.ui.view" id="view_company_page_mercadolibreb">
            <field name="name">res.company.form.meli</field>
            <field name="model">res.company</field>
            <field name="inherit_id" ref="base.view_company_form"/>
            <field name="arch" type="xml">
                <data>
                    <notebook>
                        <page string="MercadoLibre">
							<group>
								<field name="mercadolibre_state" invisible="0"/>
								<field name="mercadolibre_client_id" />
								<field name="mercadolibre_secret_key" />
								<field name="mercadolibre_redirect_uri" />
								<field name="mercadolibre_access_token" invisible="0"/>
								<field name="mercadolibre_refresh_token" invisible="0"/>
								<field name="mercadolibre_code" invisible="0"/>
                <field name="mercadolibre_category_import" invisible="0"/>
                <field name="mercadolibre_recursive_import" invisible="0"/>
                <field name="mercadolibre_seller_id" invisible="0"/>
              </group>
              <group name="Cron Job">
                <field name="mercadolibre_cron_refresh" invisible="0"/>
                <field name="mercadolibre_cron_mail" invisible="0"/>
                <field name="mercadolibre_cron_get_orders" invisible="0"/>
                <field name="mercadolibre_cron_get_questions" invisible="0"/>
                <field name="mercadolibre_cron_get_update_products" invisible="0"/>
              </group>
              <group name="Actions">

								<button name='meli_login' type="object"
										string="Iniciar sesión en MLA" attrs="{'invisible':[('mercadolibre_state','=',False)]}"/>

								<button name='meli_logout' type="object"
										string="Cerrar sesión con MLA" attrs="{'invisible':[('mercadolibre_state','=',True)]}"/>

                                <button name='meli_query_orders' type="object"
										string="Iniciar búsqueda de órdenes en MLA" attrs="{'invisible':[('mercadolibre_state','=',True)]}"/>

								<button name='meli_query_products' type="object"
										string="Iniciar búsqueda de productos en MLA" attrs="{'invisible':[('mercadolibre_state','=',True)]}"/>

                    <button name='meli_update_products' type="object"
    										string="Iniciar actualización de productos y stock desde MLA" attrs="{'invisible':[('mercadolibre_state','=',True)]}"/>

                        <button name='meli_import_categories' type="object"
                            										string="Iniciar importación de categorías en MLA" attrs="{'invisible':[('mercadolibre_state','=',True)]}"/>


<!--
								<button name='%(meli_login_action)d' type="action"
										string="Login en MLA (action)"/>

								<a href="/meli_login" target="_blank">URL</a>-->
							</group>
                        </page>
                    </notebook>
                </data>
            </field>
        </record>


    </data>
</openerp>
